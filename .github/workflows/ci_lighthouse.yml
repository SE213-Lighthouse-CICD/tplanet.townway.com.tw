---
name: CI_Lighthouse
on: [push]
jobs:
  lhci:
    name: Lighthouse Test
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code     
        uses: actions/checkout@v3
      - name: Use Node.js 16.x
        uses: actions/setup-node@v3
        with:
          node-version: 16.x
      - name: npm install   
        run:  npm install
      - name: run Lighthouse CI
        run: |
          npm install -g @lhci/cli
          lhci autorun --collect.url=https://tplanet.townway.com.tw
      - name: Generate Lighthouse report
        if: ${{ always() }}
        run: lhci upload --target=lhci --serverBaseUrl=http://220.136.137.202:9001/ --token=${{ secrets.ADMIN_TOKEN_EDWARD }}      
      - name: Upload Lighthouse report
        uses: actions/upload-artifact@v2
        with: 
          name: lighthouse-report
          path: ./lighthouse-report
      
  process_report:
    name: Process Lighthouse report
    runs-on: ubuntu-latest
    needs: lhci

    steps:
      - name: Download Lighthouse report
        uses: actions/download-artifact@v2
        with: 
          name: lighthouse-report
          path: /home/orihara/lhci/lighthouse-report

      - name: Start Lighthouse CI Server
        run: npm start
...    
